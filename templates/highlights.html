{% extends "base.html" %}

{% block title %}Highlights - CPC New Haven{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-10">
    <h1 class="text-4xl font-bold mb-4 text-blue-700 hover:text-blue-900 dark:text-blue-300 dark:hover:text-blue-200 border-l-4 border-blue-500 pl-3">What's Happening at CPC</h1>
    <p class="text-lg text-gray-600 mb-10">Stay connected with featured events,
        announcements, and ongoing activities</p>

    <!-- Filter Section -->
    <div class="mb-8 flex gap-2 flex-wrap justify-center">
        <button
            class="filter-btn active px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium"
            data-filter="all">All</button>
        <button
            class="filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium"
            data-filter="event">Events</button>
        <button
            class="filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium"
            data-filter="announcement">Announcements</button>
        <button
            class="filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium"
            data-filter="ongoing">Ongoing</button>
        <button
            class="filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium"
            data-filter="superfeatured">Featured</button>
    </div>

    <!-- Highlights Section -->
    <div id="highlights-container" class="space-y-6">
        <!-- Highlights will be populated by JavaScript -->
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    let allHighlights = [];
    
    // Load highlights
    fetch('/api/highlights')
        .then(response => response.json())
        .then(data => {
            allHighlights = data.announcements || [];
            displayHighlights(allHighlights);
            setupFilters();
        })
        .catch(error => {
            console.error('Error loading highlights:', error);
            document.getElementById('highlights-container').innerHTML = '<div class="p-10 bg-gray-50 border rounded-lg text-center text-gray-600">Error loading highlights.</div>';
        });

    function displayHighlights(highlights) {
        const container = document.getElementById('highlights-container');
        container.innerHTML = '';
        
        if (highlights.length === 0) {
            container.innerHTML = '<div class="p-10 bg-gray-50 border rounded-lg text-center text-gray-600">No highlights at this time.</div>';
            return;
        }

        highlights.forEach(highlight => {
            const card = document.createElement('div');
            card.classList.add('p-6', 'border', 'rounded-lg', 'shadow-sm', 'hover:shadow-md', 'transition', 'bg-white', 'highlight-card', 'show');
            card.dataset.type = highlight.type || '';
            card.dataset.category = highlight.category || '';
            card.dataset.superfeatured = highlight.superfeatured || false;
            
            if (highlight.superfeatured) {
                card.classList.add('border-yellow-400', 'border-2');
            }
            
            let html = '';
            
            // Add image if available
            if (highlight.featuredImage) {
                const imageClass = highlight.imageDisplayType === 'poster' ? 'object-contain bg-white' : 'object-cover';
                html += `
                    <img src="${highlight.featuredImage}" alt="${highlight.title}" class="w-full max-w-2xl mx-auto rounded-lg shadow-md mt-6 mb-6 ${imageClass}" style="max-height: 400px;">
                `;
            }
            
            // Add title
            html += `<h2 class="text-2xl font-semibold mb-4">${highlight.title}</h2>`;
            
            // Add meta badges
            html += '<div class="flex gap-3 mb-4 text-sm text-gray-500 flex-wrap">';
            
            if (highlight.type) {
                html += `<span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full">${highlight.type}</span>`;
            }
            
            if (highlight.superfeatured) {
                html += '<span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full font-semibold">‚≠ê Featured</span>';
            }
            
            if (highlight.dateEntered) {
                html += `<span class="text-gray-500">üìÖ ${highlight.dateEntered}</span>`;
            }
            
            html += '</div>';
            
            // Add description
            html += `<div class="text-base leading-relaxed text-gray-700">${highlight.description}</div>`;
            
            card.innerHTML = html;
            container.appendChild(card);
        });
    }

    function setupFilters() {
        const filterButtons = document.querySelectorAll('.filter-btn');
        
        filterButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                // Update active button
                filterButtons.forEach(b => {
                    b.classList.remove('active', 'bg-blue-600', 'text-white');
                    b.classList.add('bg-gray-200', 'text-gray-700');
                });
                this.classList.add('active', 'bg-blue-600', 'text-white');
                this.classList.remove('bg-gray-200', 'text-gray-700');
                
                const filter = this.dataset.filter;
                filterHighlights(filter);
            });
        });
    }

    function filterHighlights(filter) {
        const cards = document.querySelectorAll('.highlight-card');
        
        cards.forEach(card => {
            if (filter === 'all') {
                card.classList.remove('hidden');
                card.classList.add('show');
            } else if (filter === 'superfeatured') {
                if (card.dataset.superfeatured === 'true') {
                    card.classList.remove('hidden');
                    card.classList.add('show');
                } else {
                    card.classList.add('hidden');
                    card.classList.remove('show');
                }
            } else {
                if (card.dataset.type === filter) {
                    card.classList.remove('hidden');
                    card.classList.add('show');
                } else {
                    card.classList.add('hidden');
                    card.classList.remove('show');
                }
            }
        });
    }
});
</script>
{% endblock %}
