{% extends "base.html" %}

{% block title %}Announcements - CPC New Haven{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-10">
    <h1 class="text-4xl font-bold mb-4">Announcements</h1>
    <p class="text-lg text-gray-600 mb-10">Latest news and announcements from
        CPC New Haven</p>

    <div id="announcements-container"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Announcements will be populated by JavaScript -->
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load announcements
    fetch('/api/announcements')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('announcements-container');
            
            if (data.announcements && data.announcements.length > 0) {
                let html = '';
                
                data.announcements.forEach(announcement => {
                    html += `
                        <div class="p-6 border rounded-lg shadow-sm hover:shadow-md transition bg-white flex flex-col h-full">
                            ${announcement.featuredImage ? `
                                <img src="${announcement.featuredImage}" alt="${announcement.title}" class="w-full h-48 object-cover rounded-lg mb-4">
                            ` : ''}
                            <h3 class="text-xl font-semibold mb-2">${announcement.title}</h3>
                            <div class="flex gap-3 mb-4 text-sm text-gray-500 flex-wrap">
                                ${announcement.type ? `<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full">${announcement.type}</span>` : ''}
                                ${announcement.category ? `<span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full">${announcement.category}</span>` : ''}
                            </div>
                            <p class="text-base leading-relaxed text-gray-700 mb-4 flex-grow">${announcement.description}</p>
                            ${announcement.dateEntered ? `<p class="text-sm text-gray-500 mt-auto">${announcement.dateEntered}</p>` : ''}
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } else {
                container.innerHTML = `
                    <div class="p-10 bg-gray-50 border rounded-lg text-center text-gray-600">
                        No announcements at this time.
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Error loading announcements:', error);
            document.getElementById('announcements-container').innerHTML = `
                <div class="p-10 bg-gray-50 border rounded-lg text-center text-gray-600">
                    Error loading announcements.
                </div>
            `;
        });
});
</script>
{% endblock %}
